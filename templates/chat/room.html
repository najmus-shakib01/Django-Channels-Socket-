<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realtime Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5 d-flex justify-content-center">
    <div class="card shadow-sm w-100" style="max-width: 800px;">
        <div class="card-header text-center bg-primary text-white">
            <h4 class="mb-0">Room: {{ room_name }}</h4>
        </div>
        <div class="card-body d-flex flex-column" style="height: 500px;">
            <div id="chat-log" class="flex-grow-1 mb-3 overflow-auto border rounded p-3 bg-light"></div>

            <div class="input-group">
                <input id="chat-message-input" type="text" class="form-control" placeholder="Type your message..." aria-label="Message">
                <button id="chat-message-submit" class="btn btn-primary">Send</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script> 
    const roomName = "{{room_name}}"
    const chatLog = document.getElementById('chat-log');
    const messageInput = document.getElementById('chat-message-input');    
    const sendButton = document.getElementById('chat-message-submit');   
    
    const chatSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/chat/' + roomName + '/'
    );

    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const messageElement = document.createElement('div');
        messageElement.textContent = data.message;
        messageElement.className = "mb-2 p-2 bg-primary text-white rounded";
        chatLog.appendChild(messageElement);
        chatLog.scrollTop = chatLog.scrollHeight; 
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    sendButton.onclick = function(e) {
        const message = messageInput.value.trim();
        if (message.length === 0) return;
        chatSocket.send(JSON.stringify({'message': message}));
        messageInput.value = '';
    };

    messageInput.addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            sendButton.click();
            e.preventDefault();
        }
    });
</script> 

</body>
</html>
